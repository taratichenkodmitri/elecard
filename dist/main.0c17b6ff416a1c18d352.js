(()=>{"use strict";var e,t,r,s,a={10:(e,t,r)=>{r.a(e,(async(e,t)=>{try{let e=new(r(305).g);await e.init(),e.run(),t()}catch(e){t(e)}}),1)},305:(e,t,r)=>{r.d(t,{g:()=>l});class s{url="http://contest.elecard.ru/frontend_data/";constructor(){}async getJson(){await fetch("https://cors-anywhere.herokuapp.com/"+this.url+"catalog.json",{method:"GET"}).then((e=>e.json())).then((e=>{this.data=e})).catch((e=>console.error("error:",e))),this.makeImagesUrl()}makeImagesUrl(){let e=0;this.data.map((t=>{t.image=this.url+t.image,t.id=`${e}`,e++}))}getDownloadedData(){return this.data}}class a{constructor(e,t){this.amountCards=24,this.currentPage=t,this.observers=[],this.cards=e,this.currentCards=this.cards.filter(((e,t)=>this.amountCards*(this.currentPage-1)<=t&&this.amountCards*this.currentPage>t))}init(){let e=Math.ceil(this.cards.length/this.amountCards);const t=document.querySelector(".pagination");t.innerHTML="";const r=document.createElement("select");r.classList.add("navigation-selector");for(let t=1;t<=e;t++){const e=document.createElement("option");e.value=`${t}`,e.text=`page ${t}`,r.appendChild(e)}Array.from(r.options).find((e=>e.value==this.currentPage)).selected=!0,r.addEventListener("change",(e=>{this.currentPage=+e.target.value,this.currentCards=this.cards.filter(((e,t)=>this.amountCards*(this.currentPage-1)<=t&&this.amountCards*this.currentPage>t)),this.notifyObservers()})),t.appendChild(r)}registerObserver(e){this.observers.push(e)}notifyObservers(){this.observers.map((e=>{e.render()}))}}class i{constructor(e,t="size"){this.observers=[],this.cards=e,this.valueForSort=t}init(){const e=document.querySelector(".filter");e.classList.remove("hidden");document.querySelector("#filterSize").checked=!0,e.addEventListener("submit",(t=>{const r=new FormData(e);for(const e of r)this.valueForSort=e[1];this.notifyObservers(),t.preventDefault()}))}hidden(){document.querySelector(".filter").classList.add("hidden")}sortData(){switch(this.valueForSort){case"size":this.cards.sort(((e,t)=>e.filesize-t.filesize));break;case"category":this.cards.sort(((e,t)=>{let r=e.category,s=t.category;return r>s?1:r<s?-1:0}));case"date":this.cards.sort(((e,t)=>e.timestamp-t.timestamp))}}registerObserver(e){this.observers.push(e)}notifyObservers(){this.sortData(),this.observers.map((e=>{e.filterData(this.cards)}))}}class n{constructor(){}deleteData(){localStorage.removeItem("data")}getData(){return JSON.parse(localStorage.getItem("data"))}static setData(e){localStorage.setItem("data",JSON.stringify(e))}}class o{constructor(){}static convertTimestamp(e){let t=new Date(e);return`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}::${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`}}class c{constructor(e){this.modifyCards=e,this.pagination=new a(e,1),this.filter=new i(e)}init(){this.pagination.init(),this.pagination.registerObserver(this),this.filter.init(),this.filter.registerObserver(this),this.filter.notifyObservers(),this.render()}render(){const e=document.querySelector(".card-container");e.innerHTML="",this.pagination.currentCards.map((t=>{const r=document.createElement("div");r.id=t.id,r.classList.add("card");const s=document.createElement("div");s.classList.add("image-container"),r.appendChild(s);const a=document.createElement("a");a.href="http://contest.elecard.ru/frontend/task";const i=document.createElement("img");i.src=t.image,a.appendChild(i),s.appendChild(a);const n=document.createElement("button");n.classList.add("close-button"),this.addButtonListener(n),r.appendChild(n);const c=document.createElement("span");c.classList.add("close-icon"),n.appendChild(c);const d=document.createElement("p");d.innerHTML=`category: ${t.category}; size: ${t.filesize}; date: ${o.convertTimestamp(t.timestamp)}`,r.appendChild(d),e.appendChild(r)}))}filterData(e){this.modifyCards=e,this.rebuildPagination(),this.render()}addButtonListener(e){e.addEventListener("click",(e=>{const t=e.currentTarget.parentNode;this.modifyCards=this.modifyCards.filter((e=>e.id!=t.id)),n.setData(this.modifyCards),t.parentNode.removeChild(t),this.rebuildFilter(),this.rebuildPagination()}))}rebuildPagination(){let e=this.pagination.currentPage;this.pagination=new a(this.modifyCards,e),this.pagination.init(),this.pagination.registerObserver(this),this.pagination.notifyObservers()}rebuildFilter(){let e=this.filter.valueForSort;this.filter=new i(this.modifyCards,e),this.filter.init(),this.filter.registerObserver(this),this.filter.notifyObservers()}destroy(){this.filter.hidden()}}class d{constructor(e,t){this.defualtCards=e.sort(((e,t)=>{let r=e.category,s=t.category;return r>s?1:r<s?-1:0})),this.urlSize=t}init(){const e=document.querySelector(".content"),t=document.createElement("ul"),r=this.createNode("category"),s=this.createChildren(r);let a={},i={},n={},o={};this.defualtCards.map((e=>{e.category!==a.category&&(i=this.createNode(e.category),o=this.createChildren(i),s.appendChild(i)),n=this.createLeaf(e),o.appendChild(n),a=e})),t.appendChild(r),e.appendChild(t),this.addOpenListeners()}createNode(e){const t=document.createElement("li"),r=document.createElement("span");return r.classList.add("caret"),t.appendChild(r),t.innerHTML+=e,t}createChildren(e){const t=document.createElement("ul");return t.classList.add("hidden"),e.appendChild(t),t}createLeaf(e){const t=document.createElement("li");return t.innerHTML=`image: <a href="${e.image}">${e.image.slice(this.urlSize,e.image.length)}</a>; filesize: ${e.filesize}; data: ${o.convertTimestamp(e.timestamp)}`,t}addOpenListeners(){document.querySelectorAll(".caret").forEach((e=>{e.addEventListener("click",(function(){this.parentElement.querySelector(".hidden").classList.toggle("active"),this.classList.toggle("caret-down")}))}))}}class l{constructor(e="cards"){this.valueForDisplay=e,this.loader=new s,this.viewer=null,this.storage=new n,this.toggleFlag=!0}async init(){await this.loader.getJson(),this.refreshControl();const e=document.querySelector(".display");e.addEventListener("submit",(t=>{const r=new FormData(e);for(const e of r)this.valueForDisplay=e[1];this.run(),t.preventDefault()}))}refreshControl(){const e=document.querySelector(".refresh-button");e.classList.add("hidden"),e.addEventListener("click",(e=>{this.storage.deleteData(),this.run()}))}toggleRefreshControl(){document.querySelector(".refresh-button").classList.toggle("hidden")}run(){const e=document.querySelector(".content");switch(e.innerHTML="",this.valueForDisplay){case"cards":const t=document.createElement("div");t.classList.add("card-container"),e.appendChild(t);const r=document.createElement("div");r.classList.add("pagination"),e.appendChild(r);const s=this.storage.getData()||this.loader.getDownloadedData();this.viewer=new c(s),this.viewer.init(),this.toggleFlag&&(this.toggleRefreshControl(),this.toggleFlag=!1);break;case"tree":this.viewer.destroy(),this.viewer=new d(this.loader.getDownloadedData(),this.loader.url.length),this.viewer.init(),this.toggleRefreshControl(),this.toggleFlag=!0}}}}},i={};function n(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return a[e](r,r.exports,n),r.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",r="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=e=>{e&&!e.d&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},n.a=(a,i,n)=>{var o;n&&((o=[]).d=1);var c,d,l,h=new Set,u=a.exports,m=new Promise(((e,t)=>{l=t,d=e}));m[t]=u,m[e]=e=>(o&&e(o),h.forEach(e),m.catch((e=>{}))),a.exports=m,i((a=>{var i;c=(a=>a.map((a=>{if(null!==a&&"object"==typeof a){if(a[e])return a;if(a.then){var i=[];i.d=0,a.then((e=>{n[t]=e,s(i)}),(e=>{n[r]=e,s(i)}));var n={};return n[e]=e=>e(i),n}}var o={};return o[e]=e=>{},o[t]=a,o})))(a);var n=()=>c.map((e=>{if(e[r])throw e[r];return e[t]})),d=new Promise((t=>{(i=()=>t(n)).r=0;var r=e=>e!==o&&!h.has(e)&&(h.add(e),e&&!e.d&&(i.r++,e.push(i)));c.map((t=>t[e](r)))}));return i.r?d:n()}),(e=>(e?l(m[r]=e):d(u),s(o)))),o&&(o.d=0)},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);n(10)})();
//# sourceMappingURL=main.0c17b6ff416a1c18d352.js.map